<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Manager</title>
    <style>
        body { background: #1e1e1e; color: #ccc; font-family: sans-serif; display: flex; height: 100vh; margin: 0; }
        #sidebar { width: 250px; background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; }
        #sidebar h3 { padding: 15px; margin: 0; background: #333; color: #fff; }
        #file-list { flex: 1; overflow-y: auto; }
        .file { padding: 10px 15px; cursor: pointer; border-bottom: 1px solid #383838; }
        .file:hover { background: #37373d; color: #fff; }
        #main { flex: 1; display: flex; flex-direction: column; }
        #toolbar { padding: 10px; background: #333; display: flex; gap: 10px; align-items: center; }
        button { background: #007acc; border: none; color: white; padding: 5px 15px; cursor: pointer; }
        button:hover { background: #005f9e; }
        textarea { flex: 1; background: #1e1e1e; color: #d4d4d4; border: none; padding: 15px; resize: none; outline: none; font-family: monospace; font-size: 14px; }
    </style>
</head>
<body>
    <div id="sidebar">
        <h3>üìÇ Files</h3>
        <div id="file-list"></div>
    </div>
    <div id="main">
        <div id="toolbar">
            <button onclick="save()">üíæ Save</button>
            <span id="status">Ready</span>
        </div>
        <textarea id="editor"></textarea>
    </div>
    <script>
        const token = "{{ token }}";
        let currentFile = "";

        async function loadFiles() {
            let res = await fetch(`/api/files/${token}`);
            let data = await res.json();
            document.getElementById('file-list').innerHTML = data.files.map(f => 
                `<div class="file" onclick="openFile('${f.path}')">üìÑ ${f.name}</div>`
            ).join('');
        }

        async function openFile(path) {
            currentFile = path;
            document.getElementById('status').innerText = "Loading " + path + "...";
            let res = await fetch(`/api/read/${token}`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({path: path})
            });
            let data = await res.json();
            document.getElementById('editor').value = data.content;
            document.getElementById('status').innerText = "Editing: " + path;
        }

        async function save() {
            if (!currentFile) return;
            document.getElementById('status').innerText = "Saving...";
            let res = await fetch(`/api/save/${token}`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({path: currentFile, content: document.getElementById('editor').value})
            });
            let data = await res.json();
            document.getElementById('status').innerText = data.success ? "‚úÖ Saved!" : "‚ùå Error!";
        }
        loadFiles();
    </script>
</body>
</html>
